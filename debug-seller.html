<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Seller Dashboard - Tumblera</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold mb-6">üîç Debug Seller Dashboard</h1>
            
            <div id="status" class="mb-6"></div>

            <div class="space-y-4">
                <button onclick="checkSellerAuth()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium">
                    1Ô∏è‚É£ Check Seller Authentication
                </button>
                
                <button onclick="testGetAllOrders()" class="w-full bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-medium">
                    2Ô∏è‚É£ Test getAllOrders() Function
                </button>
                
                <button onclick="queryDatabase()" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 font-medium">
                    3Ô∏è‚É£ Direct Database Query
                </button>

                <a href="seller.html" class="block w-full bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 font-medium text-center">
                    üìä Go to Seller Dashboard
                </a>
            </div>

            <div class="mt-8 p-4 bg-gray-50 rounded">
                <h3 class="font-bold mb-2">Console Output:</h3>
                <div id="console" class="bg-black text-green-400 p-4 rounded font-mono text-sm h-96 overflow-auto">
                    Ready for testing...
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const colors = {
                info: 'text-green-400',
                success: 'text-green-300',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const colors = {
                success: 'bg-green-100 border-green-400 text-green-700',
                error: 'bg-red-100 border-red-400 text-red-700',
                info: 'bg-blue-100 border-blue-400 text-blue-700',
                warning: 'bg-yellow-100 border-yellow-400 text-yellow-700'
            };
            
            status.innerHTML = `
                <div class="border-l-4 p-4 ${colors[type]}">
                    ${message}
                </div>
            `;
        }

        window.checkSellerAuth = function() {
            log('=== CHECKING SELLER AUTHENTICATION ===', 'info');
            
            const isSellerLoggedIn = localStorage.getItem('isSellerLoggedIn');
            const sellerEmail = localStorage.getItem('sellerEmail');
            
            log(`isSellerLoggedIn: ${isSellerLoggedIn}`, 'info');
            log(`sellerEmail: ${sellerEmail}`, 'info');
            
            if (isSellerLoggedIn === 'true' && sellerEmail) {
                log('‚úÖ SELLER IS AUTHENTICATED', 'success');
                showStatus(
                    `<p class="font-bold">‚úÖ Seller Authenticated</p>
                    <p class="mt-2">Email: ${sellerEmail}</p>`,
                    'success'
                );
            } else {
                log('‚ùå SELLER NOT AUTHENTICATED', 'error');
                showStatus(
                    `<p class="font-bold">‚ùå Not Authenticated</p>
                    <p class="mt-2">Please login as seller first</p>
                    <a href="login.html" class="underline">Go to Login</a>`,
                    'error'
                );
            }
        };

        window.testGetAllOrders = async function() {
            log('=== TESTING getAllOrders() FUNCTION ===', 'info');
            
            try {
                const { getAllOrders } = await import('./js/supabase.js');
                
                log('Calling getAllOrders()...', 'info');
                const result = await getAllOrders();
                
                log('Result received:', 'info');
                log(JSON.stringify(result, null, 2), 'info');
                
                if (result.success) {
                    log(`‚úÖ SUCCESS! Found ${result.orders.length} orders`, 'success');
                    
                    if (result.orders.length > 0) {
                        log('First order details:', 'info');
                        log(JSON.stringify(result.orders[0], null, 2), 'info');
                        
                        showStatus(
                            `<p class="font-bold">‚úÖ Found ${result.orders.length} Order(s)</p>
                            <p class="mt-2">First order: ${result.orders[0].customer_name}</p>
                            <p>Total: $${result.orders[0].total_amount}</p>`,
                            'success'
                        );
                    } else {
                        log('‚ö†Ô∏è No orders found in database', 'warning');
                        showStatus(
                            `<p class="font-bold">‚ö†Ô∏è No Orders Found</p>
                            <p class="mt-2">Database query successful but no orders exist</p>`,
                            'warning'
                        );
                    }
                } else {
                    log(`‚ùå FAILED: ${result.error}`, 'error');
                    showStatus(
                        `<p class="font-bold">‚ùå Query Failed</p>
                        <p class="mt-2">Error: ${result.error}</p>`,
                        'error'
                    );
                }
            } catch (error) {
                log(`‚ùå EXCEPTION: ${error.message}`, 'error');
                log(error.stack, 'error');
                showStatus(
                    `<p class="font-bold">‚ùå Exception</p>
                    <p class="mt-2">${error.message}</p>`,
                    'error'
                );
            }
        };

        window.queryDatabase = async function() {
            log('=== DIRECT DATABASE QUERY ===', 'info');
            
            try {
                const { supabase } = await import('./js/supabase.js');
                
                log('Querying orders table directly...', 'info');
                const { data, error } = await supabase
                    .from('orders')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    log(`‚ùå Database error: ${error.message}`, 'error');
                    log(`Error details: ${JSON.stringify(error, null, 2)}`, 'error');
                    showStatus(
                        `<p class="font-bold">‚ùå Database Error</p>
                        <p class="mt-2">${error.message}</p>
                        <p class="mt-2 text-xs">${error.hint || ''}</p>`,
                        'error'
                    );
                } else {
                    log(`‚úÖ Query successful! Found ${data.length} orders`, 'success');
                    
                    if (data.length > 0) {
                        log('Orders in database:', 'success');
                        data.forEach((order, i) => {
                            log(`${i + 1}. ${order.customer_name} - $${order.total_amount} - ${order.status}`, 'info');
                        });
                        
                        log('Full first order data:', 'info');
                        log(JSON.stringify(data[0], null, 2), 'info');
                        
                        showStatus(
                            `<p class="font-bold">‚úÖ Found ${data.length} Order(s) in Database</p>
                            <p class="mt-2">Latest: ${data[0].customer_name}</p>
                            <p>Email: ${data[0].customer_email}</p>
                            <p>Total: $${data[0].total_amount}</p>
                            <p>Status: ${data[0].status}</p>`,
                            'success'
                        );
                    } else {
                        log('‚ö†Ô∏è Database is empty - no orders found', 'warning');
                        showStatus(
                            `<p class="font-bold">‚ö†Ô∏è Database Empty</p>
                            <p class="mt-2">No orders in the database yet</p>
                            <p class="mt-2">Try placing a test order first</p>`,
                            'warning'
                        );
                    }
                }
            } catch (error) {
                log(`‚ùå Exception: ${error.message}`, 'error');
                log(error.stack, 'error');
                showStatus(
                    `<p class="font-bold">‚ùå Exception</p>
                    <p class="mt-2">${error.message}</p>`,
                    'error'
                );
            }
        };

        // Auto-check on load
        window.addEventListener('load', () => {
            log('Debug tool loaded. Click buttons to test.', 'info');
            checkSellerAuth();
        });
    </script>
</body>
</html>
